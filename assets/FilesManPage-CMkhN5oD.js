import{s as P,H as ve,r,a as H,o as ge,b as $,w as _e,e as t,f as ye,L as O,d as u,h as l,i as d,F as L,q as Q,E as s,j as f,x as y,k as i,g as C,t as B,u as M,O as Ce,P as we,Q as ke,R as xe,S as be,n as he,_ as Fe}from"./index-7NJvaBin.js";const De=(p="")=>P.get("/api/files.php",{params:{path:p}}),Ve=p=>P.delete("/api/files.php",{params:{path:p}}),Re=p=>P.post("/api/files.php",p,{headers:{"Content-Type":"multipart/form-data"}}),$e=p=>P.post("/api/files.php",p,{params:{action:"create_folder"}}),Me={class:"docsbox-file-header"},Ie={class:"docsbox-file-item-box"},Be={class:"docsbox-file-item-container"},Pe=["onContextmenu"],Ue=["onClick"],Ae={class:"docsbox-file-label"},Ee={class:"docsbox-file-label"},Ne={class:"dialog-footer"},Oe={class:"dialog-footer"},Le=ve({__name:"FilesManPage",setup(p){const U=r(null),w=r([]),v=r(""),k=r(!1),A=r(!1),_=r(!1),x=r(!1),E=r(null),g=r(),b=r(),c=r(null),T=r({top:0,left:0,bottom:0,right:0}),S=r({top:0,left:0,bottom:0,right:0}),G=r({getBoundingClientRect:()=>T.value}),J=r({getBoundingClientRect:()=>S.value}),I=H({path:"",file:null}),h=H({name:""}),W=o=>{g.value?.handleClose(),o.type==="dir"&&F(o.path)},Z=(o,e)=>{const{clientX:a,clientY:m}=o;T.value=DOMRect.fromRect({x:a,y:m}),c.value=e,b.value?.handleClose(),g.value?.handleOpen()},ee=o=>{if(o.target.closest(".docsbox-file-item"))return;const{clientX:a,clientY:m}=o;S.value=DOMRect.fromRect({x:a,y:m}),g.value?.handleClose(),b.value?.handleOpen()},te=()=>{b.value?.handleClose(),_.value=!0},le=()=>{b.value?.handleClose(),U.value.click()},F=async o=>{k.value=!0;try{const e=o.replace("/files/","");v.value=e;const a=await De(e);a.data.success?w.value=a.data.data:s.error(a.data.error||"获取目录失败")}catch(e){s.error("获取目录失败："+e.message)}finally{k.value=!1}},oe=o=>{g.value?.handleClose(),E.value=o,x.value=!0},ne=o=>{g.value?.handleClose();const e=window.location.origin+o.path;navigator.clipboard.writeText(e).then(()=>{s.success("链接已复制到剪贴板")}).catch(()=>{s.error("复制链接失败")})},ae=o=>{g.value?.handleClose();const e=document.createElement("a");e.href=o.path,e.download=o.name,document.body.appendChild(e),e.click(),document.body.removeChild(e),s.success("开始下载文件")},se=async o=>{x.value=!1;try{const e=await Ve(o.path);if(e.data.success){const a=w.value.findIndex(m=>m.path===o.path);a>-1&&w.value.splice(a,1),s.success("删除成功")}else s.error(e.data.error||"删除失败")}catch(e){s.error("删除失败："+e.message)}},re=async()=>{if(!I.file){s.warning("请选择要上传的文件");return}const o=new FormData;o.append("file",I.file),o.append("path",v.value),k.value=!0;try{const e=await Re(o);e.data.success?(w.value.push(e.data.data),s.success("上传成功"),I.file=null):s.error(e.data.error||"上传失败")}catch(e){s.error("上传失败："+e.message)}finally{k.value=!1}},ie=o=>{o.target.files.length>0&&(I.file=o.target.files[0],re(),o.target.value="")},j=()=>{h.name=""},q=async()=>{const o=h.name.trim();if(!o){s.warning("请输入文件夹名称");return}if(["/","\\",":","*","?",'"',"<",">","|"].some(a=>o.includes(a))){s.warning('文件夹名称不能包含特殊字符：/\\:*?"<>|');return}A.value=!0;try{const a=await $e({path:v.value,name:o});a.data.success?(await F("/files/"+v.value),s.success("文件夹创建成功"),_.value=!1,j()):s.error(a.data.error||"创建文件夹失败")}catch(a){s.error("创建文件夹失败："+a.message)}finally{A.value=!1}};return ge(()=>{F("/files/")}),(o,e)=>{const a=d("el-button"),m=d("el-breadcrumb-item"),de=d("el-breadcrumb"),N=d("el-image"),K=d("el-text"),D=d("el-icon"),V=d("el-dropdown-item"),X=d("el-dropdown-menu"),Y=d("el-dropdown"),ue=d("el-input"),fe=d("el-form-item"),pe=d("el-form"),z=d("el-dialog"),ce=ye("loading");return f(),$(L,null,[_e((f(),$("div",{class:"docsbox-files-container",onContextmenu:e[3]||(e[3]=O(n=>ee(n),["prevent"]))},[u("div",Me,[u("div",null,[t(de,{separator:"/"},{default:l(()=>[t(m,null,{default:l(()=>[t(a,{link:"",onClick:e[0]||(e[0]=n=>F("/files/"))},{default:l(()=>[...e[14]||(e[14]=[i("files",-1)])]),_:1})]),_:1}),v.value?(f(!0),$(L,{key:0},Q(v.value.split("/").filter(n=>n),(n,R)=>(f(),C(m,{key:R},{default:l(()=>[t(a,{link:"",onClick:Te=>F("/files/"+v.value.split("/").filter(me=>me).slice(0,R+1).join("/"))},{default:l(()=>[i(B(n),1)]),_:2},1032,["onClick"])]),_:2},1024))),128)):y("",!0)]),_:1})]),u("div",null,[t(a,{type:"warning",onClick:e[1]||(e[1]=n=>_.value=!0)},{default:l(()=>[...e[15]||(e[15]=[i(" 新建文件夹 ",-1)])]),_:1}),t(a,{type:"primary",onClick:e[2]||(e[2]=n=>U.value.click())},{default:l(()=>[...e[16]||(e[16]=[i(" 上传文件 ",-1)])]),_:1}),u("input",{ref_key:"fileInput",ref:U,type:"file",style:{display:"none"},onChange:ie},null,544)])]),u("div",Ie,[u("div",Be,[(f(!0),$(L,null,Q(w.value,n=>(f(),$("div",{class:"docsbox-file-item",key:n.path,onContextmenu:O(R=>Z(R,n),["prevent"])},[u("div",{class:"docsbox-image-container",onClick:R=>W(n)},[n.type==="image"?(f(),C(N,{key:0,style:{width:"120px",height:"100px"},src:n.path,fit:"contain"},null,8,["src"])):y("",!0),n.type==="dir"?(f(),C(N,{key:1,style:{width:"120px",height:"100px",cursor:"pointer"},src:"/img/dir.svg",fit:"cover"})):y("",!0),n.type==="file"?(f(),C(N,{key:2,style:{width:"120px",height:"100px"},src:"/img/file.svg",fit:"cover"})):y("",!0)],8,Ue),u("div",Ae,[t(K,{class:"docsbox-file-mtime",truncated:"",size:"small",type:"info"},{default:l(()=>[i(B(n.mtime),1)]),_:2},1024)]),u("div",Ee,[t(K,{title:n.name,truncated:""},{default:l(()=>[i(B(n.name),1)]),_:2},1032,["title"])])],40,Pe))),128))])])],32)),[[ce,k.value]]),t(Y,{ref_key:"dropdownRef",ref:g,"virtual-ref":G.value,"show-arrow":!1,"popper-options":{modifiers:[{name:"offset",options:{offset:[0,0]}}]},"virtual-triggering":"",trigger:"contextmenu",placement:"bottom-start"},{dropdown:l(()=>[t(X,null,{default:l(()=>[c.value&&c.value.type!=="dir"?(f(),C(V,{key:0,onClick:e[4]||(e[4]=n=>ne(c.value))},{default:l(()=>[t(D,null,{default:l(()=>[t(M(Ce))]),_:1}),e[17]||(e[17]=i(" 复制链接 ",-1))]),_:1})):y("",!0),c.value&&c.value.type!=="dir"?(f(),C(V,{key:1,onClick:e[5]||(e[5]=n=>ae(c.value))},{default:l(()=>[t(D,null,{default:l(()=>[t(M(we))]),_:1}),e[18]||(e[18]=i(" 下载 ",-1))]),_:1})):y("",!0),t(V,{onClick:e[6]||(e[6]=n=>oe(c.value)),divided:""},{default:l(()=>[t(D,null,{default:l(()=>[t(M(ke))]),_:1}),e[19]||(e[19]=i(" 删除 ",-1))]),_:1})]),_:1})]),_:1},8,["virtual-ref"]),t(Y,{ref_key:"emptyAreaDropdownRef",ref:b,"virtual-ref":J.value,"show-arrow":!1,"popper-options":{modifiers:[{name:"offset",options:{offset:[0,0]}}]},"virtual-triggering":"",trigger:"contextmenu",placement:"bottom-start"},{dropdown:l(()=>[t(X,null,{default:l(()=>[t(V,{onClick:te},{default:l(()=>[t(D,null,{default:l(()=>[t(M(xe))]),_:1}),e[20]||(e[20]=i(" 新建文件夹 ",-1))]),_:1}),t(V,{onClick:le},{default:l(()=>[t(D,null,{default:l(()=>[t(M(be))]),_:1}),e[21]||(e[21]=i(" 上传文件 ",-1))]),_:1})]),_:1})]),_:1},8,["virtual-ref"]),t(z,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=n=>_.value=n),title:"新建文件夹",width:"30%",onClose:j},{footer:l(()=>[u("span",Ne,[t(a,{onClick:e[9]||(e[9]=n=>_.value=!1)},{default:l(()=>[...e[22]||(e[22]=[i("取消",-1)])]),_:1}),t(a,{type:"primary",onClick:q,loading:A.value},{default:l(()=>[...e[23]||(e[23]=[i(" 创建 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[t(pe,{model:h,onSubmit:e[8]||(e[8]=O(()=>{},["prevent"]))},{default:l(()=>[t(fe,{label:"文件夹名称",required:""},{default:l(()=>[t(ue,{modelValue:h.name,"onUpdate:modelValue":e[7]||(e[7]=n=>h.name=n),placeholder:"请输入文件夹名称",onKeyup:he(q,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(z,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=n=>x.value=n),title:"删除确认？",width:"500","align-center":""},{footer:l(()=>[u("div",Oe,[t(a,{onClick:e[11]||(e[11]=n=>x.value=!1)},{default:l(()=>[...e[24]||(e[24]=[i("取消",-1)])]),_:1}),t(a,{type:"danger",onClick:e[12]||(e[12]=n=>se(E.value))},{default:l(()=>[...e[25]||(e[25]=[i(" 删除 ",-1)])]),_:1})])]),default:l(()=>[u("span",null,"确定删除 "+B(E.value.name)+" 吗？",1)]),_:1},8,["modelValue"])],64)}}}),je=Fe(Le,[["__scopeId","data-v-8759fd82"]]);export{je as default};
