import{s as p,_ as m,r as o,o as h,E as l,w,f as A,b as C,e as I,j as P}from"./index-7NJvaBin.js";import{C as b}from"./category-B0f5lV6B.js";import{g as D}from"./PageManPage-C-PhHqHG.js";const E=async c=>{try{const a=await p.get(`/api/categories.php?pageId=${c}`);let e={data:[],updated_at:a.data.updated_at||null};if(a.data.status==="success")if(a.data.data)if(typeof a.data.data=="object")if(a.data.data.data)if(typeof a.data.data.data=="string")try{e.data=JSON.parse(a.data.data.data)}catch(s){console.error("解析分类数据JSON失败:",s)}else(Array.isArray(a.data.data.data)||typeof a.data.data.data=="object")&&(e.data=a.data.data.data);else{if(a.data.data.data!==void 0)if(typeof a.data.data.data=="string")try{e.data=JSON.parse(a.data.data.data)}catch(s){console.error("解析分类数据JSON失败:",s)}else(Array.isArray(a.data.data.data)||typeof a.data.data.data=="object")&&(e.data=a.data.data.data);else e.data=[];a.data.data.updated_at&&(e.updated_at=a.data.data.updated_at)}else Array.isArray(a.data.data)&&(e.data=a.data.data);else e.data=[];else console.error("获取分类数据失败:",a.data.message||"未知错误"),a.data.message==="该页面不存在分类数据"&&(e.data=[]);return e}catch(a){return console.error("获取分类数据出错:",a),{data:[],updated_at:null}}},N=async(c,a)=>{try{const e={pageId:c,...a};return(await p.post("/api/categories.php",e)).data}catch(e){throw console.error("保存分类数据出错:",e),e}},S={class:"docsbox-cat-container"},j={__name:"CatManPage",setup(c){const a=o(!0);h(async()=>{await g()});const e=o([]),s=o(""),g=async()=>{e.value=await D(),n.value=e.value.map(t=>({value:t.id,label:t.name})),n.value.length>0&&(s.value=n.value[0].value,await u(s.value)),a.value=!1},n=o([]),d=o([]),i=o(null),u=async t=>{try{const r=await E(t);Array.isArray(r.data)?d.value=r.data:d.value=[],i.value=r.updated_at||Date.now()}catch(r){console.error("加载分类数据失败:",r),l.error("加载分类数据失败"),d.value=[],i.value=null}},v=async t=>{a.value=!0,s.value=t,await u(t),a.value=!1},f=async()=>{try{const t=await N(s.value,{data:d.value,updated_at:i.value});t.status==="success"?(i.value=t.updated_at||Date.now(),l.success("分类数据保存成功")):t.status==="conflict"?l.error("数据已被其他用户修改，请刷新页面后重新编辑"):l.error(t.message||"保存分类数据失败")}catch(t){console.error("保存分类数据失败:",t),l.error("保存分类数据时发生错误")}};return(t,r)=>{const y=A("loading");return w((P(),C("div",S,[I(b,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=_=>d.value=_),"page-items":n.value,onPageChange:v,onSave:f,selectItem:s.value,title:"分类管理"},null,8,["modelValue","page-items","selectItem"])])),[[y,a.value]])}}},M=m(j,[["__scopeId","data-v-1612064b"]]);export{M as default};
