import{s as $,_ as j,r,c as ee,o as ae,m as te,E as h,b as I,d as o,e as n,h as d,n as le,i as c,w as ne,f as oe,g as z,F as U,j as y,u as se,p as re,q as T,k,t as de,l as ue}from"./index-kf-u0agq.js";import{m as ce}from"./markdown-Bbg14IfY.js";import{g as ie}from"./PageManPage-BRr_k9ip.js";const pe=async v=>{try{return(await $.get("/api/documents.php",{params:v})).data}catch(s){throw console.error("获取文档列表失败:",s),s}},ve=async(v,s)=>{try{return(await $.put(`/api/documents.php?id=${v}`,s)).data}catch(i){throw console.error("更新文档失败:",i),i}},me=async v=>{try{return(await $.delete(`/api/documents.php?id=${v}`)).data}catch(s){throw console.error("删除文档失败:",s),s}},ge={class:"docsbox-doc-manage-container"},fe={class:"docsbox-operation-bar"},ye={class:"docsbox-table-container"},_e={class:"docsbox-pagination-container"},we={class:"docsbox-drawer-content"},be={class:"docsbox-drawer-header"},he={class:"docsbox-doc-info"},ke={class:"value"},xe={class:"docsbox-doc-info"},Ce={class:"value"},Ve={class:"docsbox-doc-info"},De={class:"value"},Ie={class:"docsbox-editor-container"},ze={class:"docsbox-drawer-footer"},Ue={__name:"DocsManPage",setup(v){const s=r("all"),i=r(""),C=r(),q=async()=>{C.value=await ie()},p=r(!1),E=r([{id:"",name:"",pageId:"",pageName:"",content:"",createdAt:"",updatedAt:""}]),_=r(!1),F=r(null),l=r({id:"",name:"",pageId:"",pageName:"",content:"",createdAt:"",updatedAt:""}),w=r({}),O=(a,e)=>{if(a===e)return!0;if(typeof a!="object"||typeof e!="object"||a===null||e===null)return!1;const f=Object.keys(a),x=Object.keys(e);if(f.length!==x.length)return!1;for(const u of f)if(a[u]!==e[u])return!1;return!0},N=ee(()=>!O({name:l.value.name,pageId:l.value.pageId,content:l.value.content},{name:w.value.name,pageId:w.value.pageId,content:w.value.content})),m=r(1),V=r(10),A=r(0),B=r([]);ae(()=>{q(),g(),document.addEventListener("keydown",L)}),te(()=>{document.removeEventListener("keydown",L)});const L=a=>{_.value&&a.ctrlKey&&a.key==="s"&&(a.preventDefault(),S(!1))},g=async()=>{try{p.value=!0;const a={currentPage:m.value,pageSize:V.value,searchName:i.value,pageId:s.value==="all"?"":s.value},e=await pe(a);E.value=e.documents||[],A.value=e.total||0,B.value=E.value}catch(a){h.error("加载文档列表失败"),console.error("加载文档失败:",a)}finally{p.value=!1}},R=async a=>{V.value=a,m.value=1,await g()},G=async a=>{m.value=a,await g()},D=async()=>{m.value=1,await g()},H=a=>{const e=a.id;window.open(`/doc/${e}`,"_blank")},J=a=>{l.value={...a},w.value={...a},_.value=!0},P=()=>{_.value=!1},S=async a=>{if(l.value&&N.value)try{p.value=!0,await ve(l.value.id,{name:l.value.name,pageId:l.value.pageId,content:l.value.content}),w.value={name:l.value.name,pageId:l.value.pageId,content:l.value.content},h.success("文档更新成功"),await g()}catch(e){h.error("文档更新失败"),console.error("更新文档失败:",e)}finally{p.value=!1,a===!0&&P()}},Q=async a=>{ue.confirm(`确定要删除文档 "${a.name}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{p.value=!0,await me(a.id),h.success("文档删除成功"),await g()}catch(e){h.error("文档删除失败"),console.error("删除文档失败:",e)}finally{p.value=!1}}).catch(()=>{})};return(a,e)=>{const f=c("el-option"),x=c("el-select"),u=c("el-button"),M=c("el-input"),b=c("el-table-column"),W=c("el-table"),X=c("el-pagination"),Y=c("el-drawer"),Z=oe("loading");return y(),I(U,null,[o("div",ge,[o("div",fe,[o("div",null,[n(M,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),placeholder:"请输入文档名称",class:"docsbox-input-with-select",onKeyup:le(D,["enter"])},{prepend:d(()=>[n(x,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value=t),style:{width:"115px"},onChange:D},{default:d(()=>[n(f,{label:"全部页面",value:"all"}),(y(!0),I(U,null,T(C.value,t=>(y(),z(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),append:d(()=>[n(u,{icon:se(re),onClick:D},null,8,["icon"])]),_:1},8,["modelValue"])])]),o("div",ye,[ne((y(),z(W,{data:B.value,stripe:"",style:{width:"100%"},"row-key":"id",border:"","empty-text":"暂无数据"},{default:d(()=>[n(b,{prop:"createdAt",label:"创建日期",width:"180"}),n(b,{prop:"updatedAt",label:"修改日期",width:"180"}),n(b,{prop:"name",label:"文档名称","show-overflow-tooltip":""}),n(b,{prop:"pageName",label:"归属页面",width:"120"}),n(b,{fixed:"right",align:"right",label:"操作","min-width":"150"},{default:d(({row:t})=>[n(u,{link:"",type:"primary",size:"small",onClick:K=>H(t),title:"修改文档"},{default:d(()=>[...e[8]||(e[8]=[k(" 查看 ",-1)])]),_:1},8,["onClick"]),n(u,{link:"",type:"primary",size:"small",onClick:K=>J(t),title:"修改文档"},{default:d(()=>[...e[9]||(e[9]=[k(" 修改 ",-1)])]),_:1},8,["onClick"]),n(u,{link:"",type:"danger",size:"small",onClick:K=>Q(t),title:"删除文档"},{default:d(()=>[...e[10]||(e[10]=[k(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,p.value]])]),o("div",_e,[n(X,{background:"",layout:"prev, pager, next, jumper, ->, total",total:A.value,"page-size":V.value,"current-page":m.value,"onUpdate:currentPage":e[2]||(e[2]=t=>m.value=t),onSizeChange:R,onCurrentChange:G},null,8,["total","page-size","current-page"])])]),n(Y,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),title:`修改文档: ${l.value.name||""}`,size:"100%",direction:"btt"},{footer:d(()=>[o("div",ze,[n(u,{onClick:P},{default:d(()=>[...e[14]||(e[14]=[k("取消",-1)])]),_:1}),n(u,{type:"primary",onClick:e[6]||(e[6]=t=>S(!0)),disabled:!N.value},{default:d(()=>[...e[15]||(e[15]=[k(" 更新（Ctrl+S） ",-1)])]),_:1},8,["disabled"])])]),default:d(()=>[o("div",we,[o("div",be,[o("div",he,[e[11]||(e[11]=o("span",{class:"label"},"文档名称：",-1)),o("span",ke,[n(M,{modelValue:l.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.name=t),placeholder:"请输入文档名称"},null,8,["modelValue"])])]),o("div",xe,[e[12]||(e[12]=o("span",{class:"label"},"归属页面：",-1)),o("span",Ce,[n(x,{modelValue:l.value.pageId,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.pageId=t),style:{width:"115px"}},{default:d(()=>[(y(!0),I(U,null,T(C.value,t=>(y(),z(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),o("div",Ve,[e[13]||(e[13]=o("span",{class:"label"},"创建日期：",-1)),o("span",De,de(l.value.createdAt),1)])]),o("div",Ie,[n(ce,{modelValue:l.value.content,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.content=t),ref_key:"editorRef",ref:F},null,8,["modelValue"])])])]),_:1},8,["modelValue","title"])],64)}}},Ae=j(Ue,[["__scopeId","data-v-e2da3bce"]]);export{Ae as default};
