import{_ as L,r as y,a as T,c as z,o as J,E as f,b as A,d as a,e as o,w as G,f as q,g as F,h as s,i as v,j as U,k as d,t as H,l as K}from"./index-7NJvaBin.js";import{u as C}from"./upload-CjT1L278.js";import{C as Q}from"./category-B0f5lV6B.js";import{g as R,d as W,u as X,a as Y}from"./PageManPage-C-PhHqHG.js";const Z={class:"docsbox-page-man-container"},j={class:"docsbox-box"},ee=["src"],le=["src"],te={class:"docsbox-img-grid"},oe={style:{width:"50px",height:"50px"}},ne={style:{width:"190px",height:"50px"}},ae={class:"docsbox-form-item-label",style:{"margin-top":"20px"}},se={class:"docsbox-form-item-label"},ie={class:"docsbox-form-item-label"},de={class:"docsbox-form-item-label"},re={style:{"margin-bottom":"20px"}},ue={style:{flex:"1",display:"flex","justify-content":"flex-end"}},ce={__name:"PageManPage",setup(me){const m=y([]),t=T({id:"",name:"",description:"",overview:"",codeSection:"",iconUrl:"",logoUrl:"",color:"#4f7de0",menu:[]}),g=y(!1),u=y(!1),x=y(!1),w=y(!1),V=y({}),k=(l,e)=>{if(l===e)return!0;if(typeof l!="object"||typeof e!="object"||l===null||e===null)return!1;const i=Object.keys(l),r=Object.keys(e);if(i.length!==r.length)return!1;for(const c of i)if(typeof l[c]=="object"&&typeof e[c]=="object"){if(!k(l[c],e[c]))return!1}else if(l[c]!==e[c])return!1;return!0},h=z(()=>u.value?!k(t,V.value):!0);J(async()=>{await O()});const O=async()=>{x.value=!0;try{const l=await R();m.value=l}catch{f.error("加载页面列表失败")}finally{x.value=!1}},S=()=>{u.value=!1,Object.assign(t,{id:"",name:"",description:"",overview:"",codeSection:"",iconUrl:"",logoUrl:"",color:"#4f7de0",menu:[]}),g.value=!0},P=l=>{u.value=!0,Object.assign(t,{id:l.id,name:l.name,description:l.description||"",overview:l.overview||"",codeSection:l.codeSection||"",iconUrl:l.iconUrl||"",logoUrl:l.logoUrl||"",color:l.color,menu:JSON.parse(JSON.stringify(l.menu||[]))}),V.value=JSON.parse(JSON.stringify(t)),g.value=!0},D=l=>{const e=l.id;window.open(`/docs/${e}`,"_blank")},E=async l=>{try{await K.confirm(`确定要删除页面"${l.name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!0,await W(l.id);const e=m.value.findIndex(i=>i.id===l.id);e>-1&&m.value.splice(e,1),f.success("删除成功")}catch(e){if(e!=="cancel"){const i=e.message||"删除失败，请重试";f.error(i),console.error("删除页面异常:",e)}}finally{x.value=!1}},M=()=>{g.value=!1},B=async()=>{if(!t.name.trim()){f.warning("请输入页面名称");return}w.value=!0;try{const l={name:t.name,description:t.description,overview:t.overview,iconUrl:t.iconUrl,codeSection:t.codeSection,logoUrl:t.logoUrl,color:t.color,menu:t.menu||[]};if(u.value){if(!t.id)throw new Error("页面ID不能为空");const e=await X(t.id,l),i=m.value.findIndex(r=>r.id===t.id);i>-1&&(m.value[i]={...e}),f.success("更新成功")}else{const e=await Y(l);if(e&&e.id)m.value.push(e),f.success("添加成功");else throw new Error("返回的数据格式不正确")}g.value=!1}catch(l){console.error("操作失败详情:",l);let e=u.value?"更新失败":"添加失败";l.response?l.response.data&&l.response.data.message?e=l.response.data.message:l.response.statusText&&(e+=`: ${l.response.statusText}`):l.message&&(e+=`: ${l.message}`),f.error(e)}finally{w.value=!1}};return(l,e)=>{const i=v("el-table-column"),r=v("el-button"),c=v("el-table"),p=v("el-text"),N=v("el-color-picker"),_=v("el-input"),$=v("el-drawer"),I=q("loading");return U(),A("div",Z,[a("div",j,[G((U(),F(c,{data:m.value,stripe:"",style:{width:"100%"},"row-key":"id",border:"","empty-text":"暂无数据"},{default:s(()=>[o(i,{prop:"name",label:"页面名称",width:"180"}),o(i,{label:"ICO",width:"100"},{default:s(({row:n})=>[a("img",{src:n.iconUrl,height:"30px"},null,8,ee)]),_:1}),o(i,{label:"LOGO",width:"180"},{default:s(({row:n})=>[a("img",{src:n.logoUrl,height:"30px"},null,8,le)]),_:1}),o(i,{prop:"description",label:"页面简介"}),o(i,{prop:"createdAt",fixed:"right",label:"创建时间",width:"180"}),o(i,{fixed:"right",align:"right",label:"Operations",width:"180"},{header:s(()=>[o(r,{type:"primary",onClick:S},{default:s(()=>[...e[9]||(e[9]=[d("添加页面",-1)])]),_:1})]),default:s(({row:n})=>[o(r,{link:"",type:"primary",size:"small",onClick:b=>D(n)},{default:s(()=>[...e[10]||(e[10]=[d(" 查看 ",-1)])]),_:1},8,["onClick"]),o(r,{link:"",type:"primary",size:"small",onClick:b=>P(n)},{default:s(()=>[...e[11]||(e[11]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),o(r,{link:"",type:"danger",size:"small",onClick:b=>E(n)},{default:s(()=>[...e[12]||(e[12]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,x.value]])]),o($,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=n=>g.value=n),title:u.value?"编辑页面":"添加页面",size:"100%",direction:"btt"},{footer:s(()=>[a("div",ue,[o(r,{onClick:M},{default:s(()=>[...e[20]||(e[20]=[d("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:B,loading:w.value,disabled:u.value&&!h.value,style:{"margin-left":"10px"}},{default:s(()=>[d(H(u.value?"更新":"添加"),1)]),_:1},8,["loading","disabled"])])]),default:s(()=>[a("div",te,[a("div",null,[a("div",null,[o(p,null,{default:s(()=>[...e[13]||(e[13]=[d("ICO:",-1)])]),_:1})]),a("div",oe,[o(C,{modelValue:t.iconUrl,"onUpdate:modelValue":e[0]||(e[0]=n=>t.iconUrl=n)},null,8,["modelValue"])])]),a("div",null,[a("div",null,[o(p,null,{default:s(()=>[...e[14]||(e[14]=[d("LOGO:",-1)])]),_:1})]),a("div",ne,[o(C,{modelValue:t.logoUrl,"onUpdate:modelValue":e[1]||(e[1]=n=>t.logoUrl=n)},null,8,["modelValue"])])]),a("div",null,[a("div",null,[o(p,null,{default:s(()=>[...e[15]||(e[15]=[d("主题颜色:",-1)])]),_:1})]),a("div",null,[o(N,{modelValue:t.color,"onUpdate:modelValue":e[2]||(e[2]=n=>t.color=n)},null,8,["modelValue"])])])]),a("div",ae,[o(p,null,{default:s(()=>[...e[16]||(e[16]=[d("页面名称：",-1)])]),_:1})]),a("div",null,[o(_,{modelValue:t.name,"onUpdate:modelValue":e[3]||(e[3]=n=>t.name=n),placeholder:"请输入页面名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),a("div",se,[o(p,null,{default:s(()=>[...e[17]||(e[17]=[d("页面简介：",-1)])]),_:1})]),a("div",null,[o(_,{modelValue:t.description,"onUpdate:modelValue":e[4]||(e[4]=n=>t.description=n),placeholder:"请输入页面简介",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),a("div",ie,[o(p,null,{default:s(()=>[...e[18]||(e[18]=[d("页面概述(支持Markdown语法)：",-1)])]),_:1})]),a("div",null,[o(_,{modelValue:t.overview,"onUpdate:modelValue":e[5]||(e[5]=n=>t.overview=n),type:"textarea",rows:3,placeholder:"请输入页面概述(支持Markdown语法)"},null,8,["modelValue"])]),a("div",de,[o(p,null,{default:s(()=>[...e[19]||(e[19]=[d("代码块：",-1)])]),_:1})]),a("div",re,[o(_,{modelValue:t.codeSection,"onUpdate:modelValue":e[6]||(e[6]=n=>t.codeSection=n),type:"textarea",rows:3,placeholder:"请输入代码块"},null,8,["modelValue"])]),a("div",null,[o(Q,{modelValue:t.menu,"onUpdate:modelValue":e[7]||(e[7]=n=>t.menu=n),title:"导航设置",pages:!1,saveButton:!1},null,8,["modelValue"])])]),_:1},8,["modelValue","title"])])}}},ye=L(ce,[["__scopeId","data-v-05023495"]]);export{ye as default};
